import{computed as n,defineComponent as b,h as D,inject as K,nextTick as ae,onMounted as F,onUnmounted as re,provide as oe,ref as S,watchEffect as ne}from"vue";import{render as P,Features as _}from'../../utils/render.js';import{Keys as ie}from'../../keyboard.js';import{useId as T}from'../../hooks/use-id.js';import{FocusTrap as E}from'../../components/focus-trap/focus-trap.js';import{useInert as U}from'../../hooks/use-inert.js';import{Portal as Y,PortalGroup as ue}from'../portal/portal.js';import{StackMessage as z,useStackProvider as se}from'../../internal/stack-context.js';import{match as G}from'../../utils/match.js';import{ForcePortalRoot as B}from'../../internal/portal-force-root.js';import{Description as pe,useDescriptions as fe}from'../description/description.js';import{dom as L}from'../../utils/dom.js';import{useOpenClosed as de,State as A}from'../../internal/open-closed.js';import{useOutsideClick as ce}from'../../hooks/use-outside-click.js';import{getOwnerDocument as ge}from'../../utils/owner.js';import{useEventListener as me}from'../../hooks/use-event-listener.js';import{Hidden as ve,Features as De}from'../../internal/hidden.js';import{useDocumentOverflowLockedEffect as Se}from'../../hooks/document-overflow/use-document-overflow.js';var ye=(l=>(l[l.Open=0]="Open",l[l.Closed=1]="Closed",l))(ye||{});let I=Symbol("DialogContext");function C(a){let i=K(I,null);if(i===null){let l=new Error(`<${a} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,C),l}return i}let H="DC8F892D-2EBD-447C-A4C8-A03058436FF4",Ke=b({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:H},initialFocus:{type:Object,default:null},id:{type:String,default:()=>`headlessui-dialog-${T()}`}},emits:{close:a=>!0},setup(a,{emit:i,attrs:l,slots:p,expose:u}){var q;let r=S(!1);F(()=>{r.value=!0});let f=S(0),d=de(),m=n(()=>a.open===H&&d!==null?(d.value&A.Open)===A.Open:a.open),x=S(new Set),v=S(null),R=S(null),O=n(()=>ge(v));if(u({el:v,$el:v}),!(a.open!==H||d!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof m.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${m.value===H?void 0:a.open}`);let c=n(()=>r.value&&m.value?0:1),k=n(()=>c.value===0),w=n(()=>f.value>1),$=K(I,null)!==null,V=n(()=>w.value?"parent":"leaf"),j=n(()=>d!==null?(d.value&A.Closing)===A.Closing:!1),J=n(()=>$||j.value?!1:k.value),Q=n(()=>{var e,t,o;return(o=Array.from((t=(e=O.value)==null?void 0:e.querySelectorAll("body > *"))!=null?t:[]).find(s=>s.id==="headlessui-portal-root"?!1:s.contains(L(R))&&s instanceof HTMLElement))!=null?o:null});U(Q,J);let W=n(()=>w.value?!0:k.value),X=n(()=>{var e,t,o;return(o=Array.from((t=(e=O.value)==null?void 0:e.querySelectorAll("[data-headlessui-portal]"))!=null?t:[]).find(s=>s.contains(L(R))&&s instanceof HTMLElement))!=null?o:null});U(X,W),se({type:"Dialog",enabled:n(()=>c.value===0),element:v,onUpdate:(e,t,o)=>{if(t==="Dialog")return G(e,{[z.Add](){x.value.add(o),f.value+=1},[z.Remove](){x.value.delete(o),f.value-=1}})}});let Z=fe({name:"DialogDescription",slot:n(()=>({open:m.value}))}),M=S(null),y={titleId:M,panelRef:S(null),dialogState:c,setTitleId(e){M.value!==e&&(M.value=e)},close(){i("close",!1)}};oe(I,y);function N(){var t,o,s;return[...Array.from((o=(t=O.value)==null?void 0:t.querySelectorAll("html > *, body > *, [data-headlessui-portal]"))!=null?o:[]).filter(g=>!(g===document.body||g===document.head||!(g instanceof HTMLElement)||g.contains(L(R))||y.panelRef.value&&g.contains(y.panelRef.value))),(s=y.panelRef.value)!=null?s:v.value]}let ee=n(()=>!(!k.value||w.value));ce(()=>N(),(e,t)=>{y.close(),ae(()=>t==null?void 0:t.focus())},ee);let te=n(()=>!(w.value||c.value!==0));me((q=O.value)==null?void 0:q.defaultView,"keydown",e=>{te.value&&(e.defaultPrevented||e.key===ie.Escape&&(e.preventDefault(),e.stopPropagation(),y.close()))});let le=n(()=>!(j.value||c.value!==0||$));return Se(O,le,e=>{var t;return{containers:[...(t=e.containers)!=null?t:[],N]}}),ne(e=>{if(c.value!==0)return;let t=L(v);if(!t)return;let o=new ResizeObserver(s=>{for(let g of s){let h=g.target.getBoundingClientRect();h.x===0&&h.y===0&&h.width===0&&h.height===0&&y.close()}});o.observe(t),e(()=>o.disconnect())}),()=>{let{id:e,open:t,initialFocus:o,...s}=a,g={...l,ref:v,id:e,role:"dialog","aria-modal":c.value===0?!0:void 0,"aria-labelledby":M.value,"aria-describedby":Z.value},h={open:c.value===0};return D(B,{force:!0},()=>[D(Y,()=>D(ue,{target:v.value},()=>D(B,{force:!1},()=>D(E,{initialFocus:o,containers:x,features:k.value?G(V.value,{parent:E.features.RestoreFocus,leaf:E.features.All&~E.features.FocusLock}):E.features.None},()=>P({ourProps:g,theirProps:s,slot:h,attrs:l,slots:p,visible:c.value===0,features:_.RenderStrategy|_.Static,name:"Dialog"}))))),D(ve,{features:De.Hidden,ref:R})])}}}),_e=b({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-overlay-${T()}`}},setup(a,{attrs:i,slots:l}){let p=C("DialogOverlay");function u(r){r.target===r.currentTarget&&(r.preventDefault(),r.stopPropagation(),p.close())}return()=>{let{id:r,...f}=a;return P({ourProps:{id:r,"aria-hidden":!0,onClick:u},theirProps:f,slot:{open:p.dialogState.value===0},attrs:i,slots:l,name:"DialogOverlay"})}}}),Ue=b({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-backdrop-${T()}`}},inheritAttrs:!1,setup(a,{attrs:i,slots:l,expose:p}){let u=C("DialogBackdrop"),r=S(null);return p({el:r,$el:r}),F(()=>{if(u.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let{id:f,...d}=a,m={id:f,ref:r,"aria-hidden":!0};return D(B,{force:!0},()=>D(Y,()=>P({ourProps:m,theirProps:{...i,...d},slot:{open:u.dialogState.value===0},attrs:i,slots:l,name:"DialogBackdrop"})))}}}),Ye=b({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-panel-${T()}`}},setup(a,{attrs:i,slots:l,expose:p}){let u=C("DialogPanel");p({el:u.panelRef,$el:u.panelRef});function r(f){f.stopPropagation()}return()=>{let{id:f,...d}=a,m={id:f,ref:u.panelRef,onClick:r};return P({ourProps:m,theirProps:d,slot:{open:u.dialogState.value===0},attrs:i,slots:l,name:"DialogPanel"})}}}),ze=b({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"},id:{type:String,default:()=>`headlessui-dialog-title-${T()}`}},setup(a,{attrs:i,slots:l}){let p=C("DialogTitle");return F(()=>{p.setTitleId(a.id),re(()=>p.setTitleId(null))}),()=>{let{id:u,...r}=a;return P({ourProps:{id:u},theirProps:r,slot:{open:p.dialogState.value===0},attrs:i,slots:l,name:"DialogTitle"})}}}),Ge=pe;export{Ke as Dialog,Ue as DialogBackdrop,Ge as DialogDescription,_e as DialogOverlay,Ye as DialogPanel,ze as DialogTitle};
